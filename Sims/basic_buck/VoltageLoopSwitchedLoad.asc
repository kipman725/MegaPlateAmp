Version 4
SHEET 1 2352 1140
WIRE 1184 -1184 832 -1184
WIRE 1232 -1184 1184 -1184
WIRE 832 -1152 832 -1184
WIRE 832 -1024 832 -1072
WIRE 1104 -944 -112 -944
WIRE 1232 -944 1168 -944
WIRE 1104 -928 224 -928
WIRE 1232 -880 1232 -944
WIRE 1392 -880 1232 -880
WIRE 1104 -848 640 -848
WIRE 1392 -848 1168 -848
WIRE 1536 -848 1456 -848
WIRE 1568 -848 1536 -848
WIRE 1104 -816 1056 -816
WIRE -144 -656 -400 -656
WIRE 192 -656 -64 -656
WIRE 576 -656 256 -656
WIRE 1040 -656 720 -656
WIRE -400 -560 -400 -656
WIRE -368 -560 -400 -560
WIRE -112 -560 -112 -944
WIRE -112 -560 -208 -560
WIRE -64 -560 -64 -656
WIRE -32 -560 -64 -560
WIRE 224 -560 224 -928
WIRE 224 -560 128 -560
WIRE 256 -560 256 -656
WIRE 320 -560 256 -560
WIRE 640 -560 640 -848
WIRE 640 -560 480 -560
WIRE 720 -560 720 -656
WIRE 784 -560 720 -560
WIRE 1056 -560 1056 -816
WIRE 1056 -560 944 -560
WIRE -368 -512 -576 -512
WIRE -144 -512 -144 -656
WIRE -144 -512 -192 -512
WIRE -112 -512 -144 -512
WIRE -32 -512 -112 -512
WIRE 192 -512 192 -656
WIRE 192 -512 144 -512
WIRE 224 -512 192 -512
WIRE 320 -512 224 -512
WIRE 576 -512 576 -656
WIRE 576 -512 496 -512
WIRE 688 -512 576 -512
WIRE 784 -512 688 -512
WIRE 1024 -512 960 -512
WIRE 1040 -512 1040 -656
WIRE 1040 -512 1024 -512
WIRE 1120 -512 1120 -528
WIRE 1120 -512 1040 -512
WIRE -112 -480 -112 -512
WIRE 688 -480 688 -512
WIRE 1024 -480 1024 -512
WIRE 224 -464 224 -512
WIRE -576 -448 -576 -512
WIRE -112 -368 -112 -400
WIRE 224 -368 224 -384
WIRE 224 -368 -112 -368
WIRE 688 -368 688 -400
WIRE 688 -368 224 -368
WIRE 1024 -368 1024 -400
WIRE 1024 -368 688 -368
WIRE 1152 -368 1024 -368
WIRE 1152 -352 1152 -368
WIRE -576 -336 -576 -368
WIRE 1088 -112 976 -112
WIRE 976 -80 976 -112
WIRE 928 -64 752 -64
WIRE 928 -16 912 -16
WIRE 976 16 976 0
WIRE 160 112 -720 112
WIRE 320 112 256 112
WIRE 528 112 320 112
WIRE 624 112 528 112
WIRE 752 112 752 -64
WIRE 752 112 704 112
WIRE 784 112 752 112
WIRE 912 112 912 -16
WIRE 912 112 864 112
WIRE 960 112 912 112
WIRE 1088 112 960 112
WIRE 1248 112 1088 112
WIRE 1456 112 1248 112
WIRE 960 128 960 112
WIRE 1088 144 1088 112
WIRE 1456 144 1456 112
WIRE 1248 176 1248 112
WIRE 528 192 528 112
WIRE 240 208 240 160
WIRE 960 224 960 208
WIRE 960 224 816 224
WIRE 1088 224 1088 208
WIRE 960 240 960 224
WIRE 1456 240 1456 224
WIRE 1408 256 1344 256
WIRE 240 304 240 288
WIRE 1408 304 1344 304
WIRE -496 320 -592 320
WIRE -368 320 -496 320
WIRE -96 320 -208 320
WIRE 192 320 -32 320
WIRE -592 336 -592 320
WIRE -96 336 -128 336
WIRE 528 336 528 256
WIRE 960 336 960 320
WIRE 960 336 528 336
WIRE 1088 336 1088 304
WIRE 1088 336 960 336
WIRE 1248 336 1248 256
WIRE 1248 336 1088 336
WIRE 1456 336 1456 320
WIRE 1456 336 1248 336
WIRE 528 352 528 336
WIRE -368 368 -464 368
WIRE 192 368 176 368
WIRE 176 384 176 368
WIRE 240 416 240 384
WIRE 320 416 320 112
WIRE 320 416 240 416
WIRE 1344 416 1344 304
WIRE -720 432 -720 112
WIRE -48 480 -112 480
WIRE -176 496 -224 496
WIRE -128 496 -128 336
WIRE -128 496 -176 496
WIRE -48 512 -48 480
WIRE 1344 528 1344 496
WIRE -720 544 -720 512
WIRE -592 544 -592 416
WIRE -112 544 -112 480
WIRE -112 544 -224 544
WIRE -224 608 -224 544
WIRE -48 608 -48 592
WIRE -144 624 -192 624
WIRE -288 640 -288 416
WIRE -256 640 -288 640
WIRE -176 656 -192 656
WIRE 416 688 144 688
WIRE -224 704 -224 672
WIRE 448 736 256 736
WIRE 656 736 512 736
WIRE -176 800 -176 656
WIRE -176 800 -480 800
WIRE 144 816 144 688
WIRE 256 832 256 736
WIRE 304 832 256 832
WIRE 448 832 368 832
WIRE 656 832 656 736
WIRE 656 832 528 832
WIRE -480 896 -480 800
WIRE -528 912 -592 912
WIRE -592 928 -592 912
WIRE 144 928 144 896
WIRE 416 928 416 688
WIRE 656 944 656 832
WIRE 656 944 448 944
WIRE 864 944 656 944
WIRE -528 960 -592 960
WIRE -144 960 -144 624
WIRE 256 960 256 832
WIRE 256 960 -144 960
WIRE 384 960 256 960
WIRE 544 976 448 976
WIRE 544 1008 544 976
WIRE 416 1024 416 992
WIRE -480 1040 -480 976
WIRE -480 1040 -624 1040
WIRE 544 1104 544 1088
FLAG -720 544 0
FLAG 528 352 0
FLAG 176 384 0
FLAG -592 544 0
FLAG -576 -336 0
FLAG 976 16 0
FLAG 1088 -112 Isense
FLAG -624 1040 Isense
FLAG 1120 -528 fs
FLAG -464 368 fs
FLAG 1152 -352 0
FLAG -496 320 logic_1
FLAG -592 928 0
FLAG 1536 -848 blank
FLAG 832 -1024 0
FLAG 1184 -1184 ramp
FLAG -176 496 blank
FLAG -592 960 ramp
FLAG 816 224 Vsense
FLAG 416 1024 0
FLAG 144 928 0
FLAG 544 1104 0
FLAG 864 944 Vsense
FLAG -48 608 0
FLAG -224 704 0
FLAG 1344 528 0
FLAG 1344 256 0
SYMBOL nmos 160 160 R270
SYMATTR InstName M1
SYMATTR Value BSZ0920NS
SYMBOL voltage -576 -464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName 16fs
SYMATTR Value PULSE(0 1 0 10n 10n 312.5n 625n)
SYMBOL voltage -720 416 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 10
SYMBOL res 1232 160 R0
SYMATTR InstName Rl
SYMATTR Value 20
SYMBOL res 224 192 R0
SYMATTR InstName R2
SYMATTR Value 5
SYMBOL schottky 544 256 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value RBR5L40A
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL ind 608 128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 100µ
SYMATTR SpiceLine Rser=0.115 Cpar=7.036p
SYMBOL cap 1072 144 R0
SYMATTR InstName Co
SYMATTR Value 100µ
SYMBOL res 880 96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 100m
SYMBOL Digital\\dflop -288 272 R0
WINDOW 3 8 12 Left 2
WINDOW 123 8 40 Left 2
SYMATTR Value trise=10n
SYMATTR Value2 tfall=10n
SYMATTR InstName A1
SYMBOL e 240 288 R0
SYMATTR InstName E1
SYMATTR Value 5
SYMBOL voltage -592 320 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 1
SYMBOL e 976 -96 R0
SYMATTR InstName E2
SYMATTR Value 10
SYMBOL Digital\\dflop -288 -608 R0
WINDOW 3 8 12 Left 2
WINDOW 123 8 40 Left 2
SYMATTR Value trise=10n
SYMATTR Value2 tfall=10n
SYMATTR InstName A3
SYMBOL res -128 -496 R0
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL res 208 -480 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL res 672 -496 R0
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL res 1008 -496 R0
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL Digital\\and 1136 -896 R0
SYMATTR InstName A7
SYMBOL Digital\\and 1136 -992 R0
SYMATTR InstName A8
SYMBOL Digital\\and 1424 -928 R0
SYMATTR InstName A9
SYMBOL Digital\\and -64 272 R0
WINDOW 3 16 52 Left 2
WINDOW 123 16 80 Left 2
SYMATTR Value trise=10n
SYMATTR Value2 tfall=10n
SYMATTR InstName A10
SYMBOL Digital\\dflop 48 -608 R0
WINDOW 3 8 12 Left 2
WINDOW 123 8 40 Left 2
SYMATTR Value trise=10n
SYMATTR Value2 tfall=10n
SYMATTR InstName A4
SYMBOL Digital\\dflop 400 -608 R0
WINDOW 3 8 12 Left 2
WINDOW 123 8 40 Left 2
SYMATTR Value trise=10n
SYMATTR Value2 tfall=10n
SYMATTR InstName A5
SYMBOL Digital\\dflop 864 -608 R0
WINDOW 3 8 12 Left 2
WINDOW 123 8 40 Left 2
SYMATTR Value trise=10n
SYMATTR Value2 tfall=10n
SYMATTR InstName A6
SYMBOL e -480 880 R0
SYMATTR InstName E3
SYMATTR Value 1
SYMBOL voltage 832 -1168 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE(0 0.7 625n 9.99u 10n 0 10u)
SYMBOL res 944 112 R0
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL res 944 224 R0
SYMATTR InstName R9
SYMATTR Value 2.232k
SYMBOL res 1072 208 R0
SYMATTR InstName R10
SYMATTR Value 1m
SYMBOL Opamps\\UniversalOpamp2 416 960 M0
SYMATTR InstName U1
SYMATTR Value2 Avol=10Meg GBW=10Meg Slew=10Meg
SYMBOL voltage 144 800 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 1
SYMBOL res 544 816 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL cap 368 816 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 33n
SYMBOL cap 512 720 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10p
SYMBOL voltage 544 992 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 1.25
SYMBOL Opamps\\UniversalOpamp2 -224 640 M0
SYMATTR InstName U2
SYMATTR Value2 Avol=10Meg GBW=10Meg Slew=10Meg
SYMBOL voltage -48 496 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 1
SYMBOL sw 1456 224 R0
SYMATTR InstName S1
SYMATTR Value MYSW
SYMBOL res 1440 128 R0
SYMATTR InstName R11
SYMATTR Value 1
SYMBOL voltage 1344 400 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value PULSE(0 1 5m 10n 10n 2m)
TEXT -120 -56 Left 2 !.tran 0 10m 1u 10n
TEXT 1224 -800 Left 2 ;Blanking pulse prevents >0.9375 duty cycle\nand resets the ramp compensating ramp generator\nPulse happens in final 1/16th of switching period
TEXT -824 -392 Left 2 ;100kHz buck
TEXT 832 -1248 Left 2 ;Compensating ramp generator
TEXT 992 -1120 Left 2 ;Ramp voltage set for D=0.7V from NXP datasheet
TEXT 1008 72 Left 2 ;Design Vo=7V, Ilim=1A
TEXT 144 656 Left 2 ;To limit the output current the voltage amplifier should not be allowed to exceed the current threshold
TEXT 1728 208 Left 2 !.model MYSW SW(Ron=1m Roff=1Meg Vt=.5 Vh=-.4)
TEXT -424 992 Left 2 ;Summing junction
